// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© joshuachang0823

//@version=4
// study("æˆ‘çš„è„šæœ¬")
//plot(close)//open close high low
// sma20=sma(close,20)
// c20=if sma20>sma20[1]//sma20[0]>sma20[1] å½“å‰barå¤§äºä¸Šä¸€ä¸ªï¼Œä¸Šæ‰¬
//     color.red
// else
//     color.blue
// plot(sma20,color=c20,style=plot.style_area,transp=50,trackprice=true)
    
// study("é»„é‡‘äº¤å‰",overlay=true)
// strategy("å›æµ‹",overlay=true)
// sma20=sma(close,20)
// sma60=sma(close,60)
// //4å°æ—¶æˆ–1å°æ—¶å‘¨æœŸæ—¶æ˜¾ç¤º15å‡çº¿ é»˜è®¤ä¸ºåˆ†é’Ÿï¼ŒS/D/W/Mä¸ºç§’æ—¥å‘¨æœˆ
// sma15=timeframe.period=="240" or timeframe.period=="5D" ? sma(close,15):na

// h1=plot(sma20,title="month",color=color.green)
// h2=plot(sma60,title="season")
// // to_buy=sma20[1]<sma60[1] and sma20[0]>sma60[0]//æ˜¨å¤©çš„æœˆçº¿åœ¨å­£çº¿ä¸‹ï¼Œä¸”ä»Šå¤©çš„æœˆçº¿åè€Œåœ¨å­£çº¿ä¸Šã€‚æœˆçº¿ç©¿è¿‡å­£çº¿ï¼Œæœ¬æœˆåœ¨æœ¬å­£ä¸­çƒ­åº¦å‡é«˜ï¼šä¹°
// //ç®€å†™
// to_buy=crossover(sma20,sma60)
// to_sale=crossunder(sma20,sma60)

// c=sma20>sma60?color.green:color.red
// fill(h1,h2,color=c)

//buy å¯ä»¥æŒ‡ä¹°å…¥ï¼Œä¹ŸæŒ‡ç»“æŸåšç©ºï¼ˆåšç©ºå¹³ä»“ï¼‰
//saleå¯ä»¥æŒ‡å–å‡ºï¼Œä¹ŸæŒ‡ç»“æŸåšå¤šï¼ˆåšå¤šå¹³ä»“ï¼‰

//longæŒæœ‰å¤šå•ï¼ŒshortæŒæœ‰ç©ºå•ï¼Œcloseä¸¤è€…éƒ½å¯å¹³ä»“
// to_long=crossover(sma20,sma60)
// to_short=crossunder(sma20,sma60)

// plotchar(to_long,char="ğŸ‘†",text="long",color=color.green,size=size.small,location=location.belowbar)
// plotchar(to_short,char="ğŸ‘‡",text="short",color=color.red,location=location.abovebar)

// strategy.entry("golden",strategy.long,qty=1000,when=to_long)//ç­–ç•¥å¼€å§‹
// strategy.close("golden",qty=1000,when=to_short)//ç­–ç•¥ç»“æŸ

// alertcondition(to_long,title="buy",message="long at {{close}} when {{time}}")
// alertcondition(to_long,title="sale",message="short at {{close}} when {{time}}")


// strategy("å›æµ‹",overlay=true)
// len20=input(title="å¿«é€Ÿçº¿",defval=20,minval=5,maxval=60,step=5)
// len60=input(title="æ…¢é€Ÿçº¿",defval=60,minval=6,maxval=160,step=5)
// sma20=sma(close,len20)
// sma60=sma(close,len60)
// //4å°æ—¶æˆ–1å°æ—¶å‘¨æœŸæ—¶æ˜¾ç¤º15å‡çº¿ é»˜è®¤ä¸ºåˆ†é’Ÿï¼ŒD/W/Mä¸ºæ—¥å‘¨æœˆ
// sma15=timeframe.period=="240" or timeframe.period=="5D" ? sma(close,15):na

// h1=plot(sma20,title="month",color=color.green)
// h2=plot(sma60,title="season")

// to_long=crossover(sma20,sma60)
// to_short=crossunder(sma20,sma60)

// plotchar(to_long,char="ğŸ‘†",text="long",color=color.green,size=size.small,location=location.belowbar)
// plotchar(to_short,char="ğŸ‘‡",text="short",color=color.red,location=location.abovebar)

// strategy.entry("golden",strategy.long,qty=1000,when=to_long)//ç­–ç•¥å¼€å§‹
// strategy.close("golden",qty=1000,when=to_short)//ç­–ç•¥ç»“æŸ


// study("æŠµæ‰£è‰ç¨¿",overlay=true)
// // plotchar(barstate.islast,char="",text="20",location=location.belowbar,offset=-20)//-20å¾€å‰20æ ¹
// // x=input(20,title="20ma")
// // l=label.new(bar_index-x,na,text="20ma",color=color.orange,textcolor=color.white,style=label.style_labelup,yloc=yloc.belowbar)
// // label.delete(l[1])//åˆ é™¤å‰ä¸€ä¸ª

// x=input(20,title="small")
// y=input(60,title="mid")
// z=input(120,title="large")

// close1=close[x]//å¾€å‰æ•°ç¬¬20æ ¹çš„æ”¶ç›˜ä»·
// close2=close[y]
// close3=close[z]

// l1=label.new(bar_index-x,na,tostring(x)+'MA '+tostring(close[x]),
//  color=color.orange,textcolor=color.white,
//  style=close[x]>open[x]?label.style_labeldown:label.style_labelup,
//  yloc=close[x]>open[x]?yloc.abovebar:yloc.belowbar)
// label.delete(l1[1])
// l2=label.new(bar_index-y,na,tostring(y)+'MA '+tostring(close[y]),
//  color=color.blue,textcolor=color.white,
//  style=close[y]>open[y]?label.style_labeldown:label.style_labelup,
//  yloc=close[y]>open[y]?yloc.abovebar:yloc.belowbar)
// label.delete(l2[1])
// l3=label.new(bar_index-z,na,tostring(z)+'MA '+tostring(close[z]),
//  color=color.red,textcolor=color.white,
//  style=close[z]>open[z]?label.style_labeldown:label.style_labelup,
//  yloc=close[z]>open[z]?yloc.abovebar:yloc.belowbar)
// label.delete(l3[1])

study("security",overlay=true)
//å½“å‰å•†å“æ˜¨å¤©çš„é«˜ä½ç‚¹ï¼Œé€‚åˆåœ¨å°å‘¨æœŸå†…è§‚å¯Ÿæ˜¯å¦ç¬¦åˆå¤§å‘¨æœŸè§„å¾‹ï¼šå¦‚åœ¨è§‚å¯Ÿåˆ†çº¿æ˜¯å¦è¶…å‡ºæ˜¨å¤©çš„é«˜ä½ç‚¹
//syminfo.tickerid å½“å‰å•†å“id
// dayhigh=security(syminfo.tickerid,"D",high)
// daylow=security(syminfo.tickerid,"D",low)
// plot(dayhigh[1],color=color.red,style=plot.style_line)
// plot(daylow[1],color=color.green,style=plot.style_line)

//å½“å‰å•†å“20åˆ†é’Ÿå¹³å‡ï¼Œé€‚åˆåœ¨å°å‘¨æœŸå†…è§‚å¯Ÿæ˜¯å¦ç¬¦åˆå¤§å‘¨æœŸè§„å¾‹ï¼šå¦‚åœ¨è§‚å¯Ÿåˆ†çº¿æ˜¯å¦è¶…å‡º20åˆ†é’Ÿå†…çš„è§„å¾‹
// sma20=sma(close,20)
// sma60=sma(close,60)
// plot(security(syminfo.tickerid,"20",sma20),color=color.green,style=plot.style_line)
// plot(security(syminfo.tickerid,"60",sma60),color=color.red,style=plot.style_line)

//å…¶ä»–å•†å“id äº¤æ˜“æ‰€ï¼šä»£å·
mkt_close=security("BINANCE:BTCUSTD","D",close)
// (close-close[1])/close[1]ä»Šå¤©æ¶¨å¹… *100æ•°ç‚¹å˜ç™¾åˆ†æ•°ï¼Œ*10000/100ç™¾åˆ†ä¹‹å‡ ç‚¹å‡ å‡ 
my_increase=(close*10000-close[21]*10000)/close[21]*100 //å½“å‰è´§å¸çš„æ¶¨å¹…
mtk_increase=(mkt_close*10000-mkt_close[21]*10000)/mkt_close[21]*100 //å¤§é¥¼çš„æ¶¨å¹…
l1=plot(my_increase)
l2=plot(mtk_increase)
hline(0)
fill(l1,l2,color=my_increase>=mtk_increase?color.green:color.red)